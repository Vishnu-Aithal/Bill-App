const itemInputs=document.querySelectorAll(".item-input"),taxInputs=document.querySelectorAll(".tax-input"),btnAdd=document.querySelector("#btn-add"),itemListDisplay=document.querySelector(".items"),output=document.querySelector(".output-value"),btnClear=document.querySelector("#btn-clear"),btnSaveClear=document.querySelector("#btn-save-clear"),btnClearHistory=document.querySelector("#btn-clear-history"),customerName=document.querySelector(".customer-name"),historyListDisplay=document.querySelector(".history");var currentList=[],previousBills=[];window.onload=(()=>{localStorage.getItem("previousBills")&&(previousBills=JSON.parse(localStorage.getItem("previousBills")),populateHistroy(previousBills))});const itemInputsEntered=()=>""!==itemInputs[0].value&&0!==Number(itemInputs[1].value),resetItemInput=()=>{itemInputs.forEach(e=>e.value=""),btnAdd.disabled=!0},updateMemory=function(e,t,l){if(itemBody={itemName:e,itemPrice:t},"add"===l)currentList.push(itemBody);else{let e=currentList.indexOf(itemBody);currentList.splice(e,1)}},calculateTotal=()=>{let e=0,t=[];document.querySelectorAll(".prices").forEach(e=>t.push(Number(e.innerText)));let l=0;if(0!==t.length){l=t.reduce((e,t)=>e+t);let i=1+Number(taxInputs[0].value)/100,a=Number(taxInputs[1].value);e=l*i+a,output.innerText=e.toFixed(2),btnSaveClear.disabled=!1}else output.innerText="",btnSaveClear.disabled=!0},addItem=function(e,t){updateMemory(e,t,"add"),resetItemInput();let l=document.createElement("li");l.classList.add("list-item"),l.innerHTML=`${e} - <span class="prices">${t}</span> ₹`;let i=document.createElement("button");i.classList.add("btn-remove"),i.classList.add("btn"),i.classList.add("btn-danger"),i.innerText="🗑️",i.onclick=(()=>{l.remove(),updateMemory(e,t,"delete"),calculateTotal()}),l.append(i),itemListDisplay.append(l),calculateTotal(),itemInputs[0].focus()},populateHistroy=function(e){for(bill of e){let t=e.indexOf(bill),l=document.createElement("li");l.classList.add("bill-item");let i=document.createElement("div");i.innerText=`Name: ${bill.customer} Date: ${bill.date}`;let a=document.createElement("div"),n="";for(listItem of bill.items)n+=`<li>${listItem.itemName} - ${listItem.itemPrice} ₹</li>`;n+=`<li>Tax: ${bill.tax} %</li><li>S.Tax: ${bill.serviceTax} ₹</li><li>Total: ${bill.total}</li>`,a.innerHTML=`\n        <button class="btn btn-primary mt-1" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${t}" aria-expanded="false" aria-controls="collapseExample">Show</button>\n        <div class="collapse mt-2" id="collapse${t}">\n            <div class="card card-body">\n            <ul>\n            ${n}\n            </ul>\n            </div>\n        </div>\n        `,l.append(i),l.append(a),historyListDisplay.append(l)}},clearAll=function(){for(currentList=[],i=itemListDisplay.children.length-1;i>0;i--)itemListDisplay.children[i].remove();for(input of document.querySelectorAll("input"))input.value="";output.innerText="",btnAdd.disabled=!0,btnSaveClear.disabled=!0},saveAndClear=function(){let e={customer:customerName.value,date:Date().slice(0,24),items:currentList,tax:taxInputs[0].value,serviceTax:taxInputs[1].value,total:Number(output.innerText)};previousBills.push(e),localStorage.setItem("previousBills",JSON.stringify(previousBills)),clearAll(),historyListDisplay.innerHTML="",populateHistroy(previousBills)},clearHistory=function(){localStorage.removeItem("previousBills"),historyListDisplay.innerHTML="",previousBills=[]};itemInputs.forEach(e=>{e.oninput=(t=>{let l=t.target.value;e.validity.valid?(e.previousValidValue=l,itemInputsEntered()?btnAdd.disabled=!1:btnAdd.disabled=!0):e.value=e.previousValidValue})}),customerName.addEventListener("keyup",e=>{"Enter"===e.key&&""!=e.target.value&&itemInputs[0].focus()}),itemInputs[0].addEventListener("keyup",e=>{"Enter"===e.key&&""!=e.target.value&&itemInputs[1].focus()}),itemInputs[1].addEventListener("keyup",e=>{"Enter"!==e.key||btnAdd.disabled||addItem(itemInputs[0].value,itemInputs[1].value)}),taxInputs.forEach(e=>{e.oninput=(t=>{let l=t.target.value;e.validity.valid?(e.previousValidValue=l,calculateTotal()):e.value=e.previousValidValue})}),btnAdd.addEventListener("click",()=>addItem(itemInputs[0].value,itemInputs[1].value)),btnClear.addEventListener("click",clearAll),btnSaveClear.addEventListener("click",saveAndClear),btnClearHistory.addEventListener("click",clearHistory);